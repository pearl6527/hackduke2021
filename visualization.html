<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
		<title>Mental Health in Tech</title>
    <script type="text/javascript" src="d3.js"></script>
    <style type="text/css">
      h1 {
        padding-left: 0.5em;
        font-family: sans-serif;
      }
      input[type=radio] {
				margin-left: 40px;
			}
    </style>
  </head>
  <body>
    <h1>Mental Health in Tech</h1>

    <p>
      <input class="genderFilter" type="radio" name="filterPreset" value="clear" checked="true"> Clear
			<input class="genderFilter" type="radio" name="filterPreset" value="female"> Male
			<input class="genderFilter" type="radio" name="filterPreset" value="male"> Female
			<input class="genderFilter" type="radio" name="filterPreset" value="other"> Other
		</p>

    <script type="text/javascript">
      let main_w = 950;
      let w = 750;
			let h = 500;
      let padding = 60;

      let svg = d3.select("body")
				.append("svg")
	      .attr("width", main_w)
	      .attr("height", h);
      
      let rowConverter = function(d) {
				return {
          Gender: d.Gender,
					NotApp: parseFloat(d["NA"]),
          Never: parseFloat(d.Never),
          Rarely: parseFloat(d.Rarely),
          Sometimes: parseFloat(d.Sometimes),
          Often: parseFloat(d.Often)
				};
			};

			d3.csv("gender_work.csv", rowConverter).then( (data)=> {
				console.log(data);

        let view = 0;
        let n_groups = Object.keys(data[0]).length - 1;
        let domain_labels = data.map(a => a.Gender);
        console.log(domain_labels);
        let key_attr = ["NotApp", "Never", "Rarely", "Sometimes", "Often"];

        let xScale = d3.scaleBand()
          .domain(domain_labels)
          .range([padding, w - padding])
          .paddingInner(0.4)
          .paddingOuter(0.2);

        let yScale = d3.scaleLinear()
          .domain([0, 1])
          .range([h - padding, padding]);

        let xAxis = d3.axisBottom()
          .scale(xScale);

        let yAxis = d3.axisLeft()
          .scale(yScale)
          .ticks(8);

        svg.append("text")
          .attr("id", "plottitle")
          .attr("x", w / 2)
          .attr("y", padding / 2)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "24px")
          .attr("fill", "black")
          .attr("stroke", "black")
          .attr("stroke-width", 0.3)
          .text("Work Interference by Gender");

        let colors = ["#2a4858", "#007383", "#00a08d", "#29c974", "#aeeb3e"];
        let cumu_y = [];
        for (let k = 0; k < domain_labels.length; k++) {
          cumu_y[k] = 0;
        }

        for (let k = 0; k < n_groups; k++) {
          svg.selectAll("rect.group" + k)
            .data(data)
            .enter()
            .append("rect")
            .attr("class", "group" + k)
            .attr("x", (d)=> { return 1 + xScale(d.Gender) })
            .attr("y", (d, i)=> {
              cumu_y[i] += d[key_attr[k]];
              return yScale(cumu_y[i]);
            })
            .attr("height", (d)=> { return h - padding - yScale(d[key_attr[k]]) })
            .attr("width", xScale.bandwidth() - 2)
            .attr("stroke", colors[k])
            .attr("fill", colors[k]);
        }

        // axes
        svg.append("g")
          .attr("class", "x axis")
          .style("font-size", "15px")
          .attr("transform", "translate(0, " + (h - padding) + ")")
          .call(xAxis);
        svg.append("g")
          .attr("class", "y axis")
          .attr("transform", "translate(" + padding + ", 0)")
          .call(yAxis);

        // y-axis label
        svg.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "14px")
          .attr("fill", "black")
          .attr("stroke", "black")
          .attr("stroke-width", 0.3)
          .attr("x", 60)
          .attr("y", 320)
          .attr("transform", "rotate(270, 10, 300)")
          .text("work_interfere");
        
        d3.selectAll("input.genderFilter")
          .on("click", function() {

            // console.log(d3.select(this).node());
            let cat = d3.select(this).node().value;

            if (cat == "clear") {
              d3.selectAll("rect")
                .attr("opacity", 1);
              return;
            }
            
            d3.selectAll("rect")
              .attr("opacity", 1)
              .filter((d)=> {
                return d.Gender != cat;
              })
              .attr("opacity", 0.5);

          });

			});

		</script>
  </body>
</html>
